name: gate

on:
  issues:
    types: [opened]

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - name: label issues by source
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          ISSUE_AUTHOR: ${{ github.event.issue.user.login }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
        run: |
          if [ "$ISSUE_AUTHOR" = "golem-experiment" ]; then
            if echo "$ISSUE_TITLE" | grep -qi '^\[directive\]'; then
              gh issue edit "$ISSUE_NUMBER" --repo golem-experiment/golem --add-label "directive"
            else
              gh issue edit "$ISSUE_NUMBER" --repo golem-experiment/golem --add-label "self"
            fi
          else
            gh issue edit "$ISSUE_NUMBER" --repo golem-experiment/golem --add-label "visitor"
          fi
